<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain/IP Scanner</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Domain/IP Scanner</h1>
        <form id="scanForm" action="http://localhost:5000/scan" method="POST">
            <label for="target">Enter Domain or IP Address:</label>
            <input type="text" id="target" name="target" placeholder="example.com or 192.168.1.1" required>

            <div class="port-range">
                <label for="startPort">Start Port:</label>
                <input type="number" id="startPort" name="startPort" min="1" max="65535" value="1" required>
            </div>
            <div class="port-range">
                <label for="endPort">End Port:</label>
                <input type="number" id="endPort" name="endPort" min="1" max="65535" value="1000" required>
            </div>

            <button type="submit">Scan</button>
        </form>
        <div id="loading" style="display: none;">Scanning...</div> <!-- Loading indicator -->
        <div id="response"></div> <!-- This div will display the results -->
        <div id="downloadLink" style="display: none;">
            <a id="csvLink" href="#" download>Download Scan Results (CSV)</a>
        </div>
    </div>
    <script>
        document.getElementById('scanForm').addEventListener('submit', function(event) {
            const targetInput = document.getElementById('target').value;
            const startPort = document.getElementById('startPort').value;
            const endPort = document.getElementById('endPort').value;
            const ipPattern = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.?(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.?(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.?(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            const domainPattern = /^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(\.[A-Za-z]{2,})+$/;
    
            // Check if the input is a valid IP address or domain name
            if (!ipPattern.test(targetInput) && !domainPattern.test(targetInput)) {
                alert('Please enter a valid IP address or domain.');
                return; // Prevent form submission
            }
    
            // Check if startPort is greater than endPort
            if (parseInt(startPort) > parseInt(endPort)) {
                alert('Start port must be less than or equal to end port.');
                return; // Prevent form submission
            }
    
            event.preventDefault(); // Prevent the form from submitting the traditional way
            document.getElementById('loading').style.display = 'block'; // Show loading
    
            const formData = new FormData(this);
            fetch(this.action, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || 'An error occurred');
                    });
                }
                return response.json();
            })
            .then(data => {
                const openPorts = data.open_ports.length ? data.open_ports.join(', ') : 'No open ports found';
                document.getElementById('response').innerText = `${data.message} IP Address: ${data.ip} Open Ports: ${openPorts}`;
                
                // Show download link for the CSV file
                document.getElementById('csvLink').href = 'http://localhost:5000/download'; // Update to point to the download endpoint
                document.getElementById('downloadLink').style.display = 'block'; // Show the download link
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('response').innerText = 'An error occurred: ' + error.message; // Display error message
            })
            .finally(() => {
                document.getElementById('loading').style.display = 'none'; // Hide loading
            });
        });
    </script>
    
</body>
</html>
